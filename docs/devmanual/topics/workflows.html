<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Otoroshi Workflows · Otoroshi</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content='otoroshi-manual'/>
<link href="https://fonts.googleapis.com/css?family=Roboto:100normal,100italic,300normal,300italic,400normal,400italic,500normal,500italic,700normal,700italic,900normal,900italicc" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<script type="text/javascript" src="../js/cc.js"></script>
<script type="text/javascript" src="../js/groups.js"></script>
<script type="text/javascript" src="../js/plugins.js"></script>
<script type="text/javascript" src="../js/ngplugins.js"></script>
<script type="text/javascript" src="../js/expression-language.js"></script>
<script type="text/javascript" src="../search/pagefind-ui.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="../css/page.css"/>
<link rel="stylesheet" type="text/css" href="../css/plugins.css"/>
<link rel="stylesheet" type="text/css" href="../search/pagefind-ui.css"/>

<!--
<link rel="shortcut icon" href="../images/favicon.ico" />
-->
</head>

<body>
<div class="off-canvas-wrapper">
<div class="off-canvas-wrapper-inner" data-off-canvas-wrapper>

<div class="off-canvas position-left" id="off-canvas-menu" data-off-canvas>
<nav class="off-canvas-nav">
<div class="nav-home">
<a href="../index.html" >
<span class="home-icon">⌂</span>Otoroshi
</a>
<div class="version-number">
latest
</div>
</div>
<div class="nav-toc">
<ul>
  <li><a href="../about.html" class="page">About Otoroshi</a></li>
  <li><a href="../architecture.html" class="page">Architecture</a></li>
  <li><a href="../features.html" class="page">Features</a></li>
  <li><a href="../getting-started.html" class="page">Getting Started</a></li>
  <li><a href="../install/index.html" class="page">Install</a>
  <ul>
    <li><a href="../install/get-otoroshi.html" class="page">Get Otoroshi</a></li>
    <li><a href="../install/setup-otoroshi.html" class="page">Setup Otoroshi</a></li>
    <li><a href="../install/run-otoroshi.html" class="page">Run Otoroshi</a></li>
  </ul></li>
  <li><a href="../entities/index.html" class="page">Main entities</a>
  <ul>
    <li><a href="../entities/routes.html" class="page">Routes</a></li>
    <li><a href="../entities/apis.html" class="page">Apis</a></li>
    <li><a href="../entities/backends.html" class="page">Backends</a></li>
    <li><a href="../entities/organizations.html" class="page">Organizations</a></li>
    <li><a href="../entities/teams.html" class="page">Teams</a></li>
    <li><a href="../entities/global-config.html" class="page">Global config</a></li>
    <li><a href="../entities/apikeys.html" class="page">Apikeys</a></li>
    <li><a href="../entities/service-groups.html" class="page">Service groups</a></li>
    <li><a href="../entities/auth-modules.html" class="page">Authentication modules</a></li>
    <li><a href="../entities/certificates.html" class="page">Certificates</a></li>
    <li><a href="../entities/jwt-verifiers.html" class="page">JWT verifiers</a></li>
    <li><a href="../entities/data-exporters.html" class="page">Data exporters</a></li>
    <li><a href="../entities/scripts.html" class="page">Scripts</a></li>
    <li><a href="../entities/tcp-services.html" class="page">TCP services</a></li>
    <li><a href="../entities/service-descriptors.html" class="page">Service descriptors</a></li>
  </ul></li>
  <li><a href="../topics/index.html" class="page">Detailed topics</a>
  <ul>
    <li><a href="../topics/engine.html" class="page">Proxy engine</a></li>
    <li><a href="../topics/expression-language.html" class="page">Expression language</a></li>
    <li><a href="../topics/secrets.html" class="page">Secrets management</a></li>
    <li><a href="../topics/otoroshi-protocol.html" class="page">The Otoroshi communication protocol</a></li>
    <li><a href="../topics/tls.html" class="page">TLS</a></li>
    <li><a href="../topics/user-rights.html" class="page">Otoroshi user rights</a></li>
    <li><a href="../topics/events-and-analytics.html" class="page">Events and analytics</a></li>
    <li><a href="../topics/monitoring.html" class="page">Monitoring</a></li>
    <li><a href="../topics/sessions-mgmt.html" class="page">Sessions management</a></li>
    <li><a href="../topics/wasm-usage.html" class="page">Otoroshi and WASM</a></li>
    <li><a href="../topics/chaos-engineering.html" class="page">Chaos engineering with the Snow Monkey</a></li>
    <li><a href="../topics/pki.html" class="page">Otoroshi&rsquo;s PKI</a></li>
    <li><a href="../topics/dev-portal.html" class="page">Developer portal with Daikoku</a></li>
    <li><a href="../topics/graphql-composer.html" class="page">GraphQL Composer Plugin</a></li>
    <li><a href="../topics/tunnels.html" class="page">Otoroshi tunnels</a></li>
    <li><a href="../topics/relay-routing.html" class="page">Relay Routing</a></li>
    <li><a href="../topics/netty-server.html" class="page">Alternative HTTP server</a></li>
    <li><a href="../topics/http3.html" class="page">HTTP3 support</a></li>
    <li><a href="../topics/anonymous-reporting.html" class="page">Anonymous reporting</a></li>
    <li><a href="../topics/opentelemetry.html" class="page">OpenTelemetry support</a></li>
    <li><a href="../topics/green-score.html" class="page">Green Score</a></li>
    <li><a href="../topics/http-listeners.html" class="page">Custom HTTP Listeners</a></li>
    <li><a href="../topics/deprecating-sd.html" class="page">Sunsetting Service Descriptors</a></li>
    <li><a href="../topics/workflows.html" class="active page">Otoroshi Workflows</a></li>
  </ul></li>
  <li><a href="../how-to-s/index.html" class="page">How to&rsquo;s</a>
  <ul>
    <li><a href="../how-to-s/wasm-usage.html" class="page">Using wasm plugins</a></li>
    <li><a href="../how-to-s/wasmo-installation.html" class="page">Deploy your own Wasmo</a></li>
    <li><a href="../how-to-s/tailscale-integration.html" class="page">Tailscale integration</a></li>
    <li><a href="../how-to-s/end-to-end-mtls.html" class="page">End-to-end mTLS</a></li>
    <li><a href="../how-to-s/export-alerts-using-mailgun.html" class="page">Send alerts using mailgun</a></li>
    <li><a href="../how-to-s/export-events-to-elastic.html" class="page">Export events to Elasticsearch</a></li>
    <li><a href="../how-to-s/import-export-otoroshi-datastore.html" class="page">Import and export Otoroshi datastore</a></li>
    <li><a href="../how-to-s/secure-app-with-auth0.html" class="page">Secure an app with Auth0</a></li>
    <li><a href="../how-to-s/secure-app-with-keycloak.html" class="page">Secure an app with Keycloak</a></li>
    <li><a href="../how-to-s/secure-app-with-ldap.html" class="page">Secure an app and/or your Otoroshi UI with LDAP</a></li>
    <li><a href="../how-to-s/secure-with-apikey.html" class="page">Secure an api with api keys</a></li>
    <li><a href="../how-to-s/secure-with-oauth1-client.html" class="page">Secure an app with OAuth1 client flow</a></li>
    <li><a href="../how-to-s/secure-with-oauth2-client-credentials.html" class="page">Secure an app with OAuth2 client_credential flow</a></li>
    <li><a href="../how-to-s/setup-otoroshi-cluster.html" class="page">Setup an Otoroshi cluster</a></li>
    <li><a href="../how-to-s/tls-using-lets-encrypt.html" class="page">TLS termination using Let&rsquo;s Encrypt</a></li>
    <li><a href="../how-to-s/secure-an-app-with-jwt-verifiers.html" class="page">Secure an api with jwt verifiers</a></li>
    <li><a href="../how-to-s/secure-the-communication-between-a-backend-app-and-otoroshi.html" class="page">Secure the communication between a backend app and Otoroshi</a></li>
    <li><a href="../how-to-s/tls-termination-using-own-certificates.html" class="page">TLS termination using your own certificates</a></li>
    <li><a href="../how-to-s/resources-loader.html" class="page">The resources loader</a></li>
    <li><a href="../how-to-s/custom-log-levels.html" class="page">Log levels customization</a></li>
    <li><a href="../how-to-s/custom-initial-state.html" class="page">Initial state customization</a></li>
    <li><a href="../how-to-s/communicate-with-kafka.html" class="page">Communicate with Kafka</a></li>
    <li><a href="../how-to-s/create-custom-auth-module.html" class="page">Create your Authentication module</a></li>
    <li><a href="../how-to-s/working-with-eureka.html" class="page">Working with Eureka</a></li>
    <li><a href="../how-to-s/instantiate-waf-coraza.html" class="page">Instantiate a WAF with Coraza</a></li>
    <li><a href="../how-to-s/zip-backend-plugin.html" class="page">Quickly expose a website and static files</a></li>
    <li><a href="../how-to-s/calling-otoroshi-from-a-frontend.html" class="page">Calling Otoroshi from a Frontend</a></li>
  </ul></li>
  <li><a href="../plugins/index.html" class="page">Otoroshi plugins</a>
  <ul>
    <li><a href="../plugins/plugins.html" class="page">Otoroshi plugins system</a></li>
    <li><a href="../plugins/create-plugins.html" class="page">Create plugins</a></li>
    <li><a href="../plugins/built-in-plugins.html" class="page">Built-in plugins</a></li>
    <li><a href="../plugins/built-in-legacy-plugins.html" class="page">Built-in legacy plugins</a></li>
  </ul></li>
  <li><a href="../api.html" class="page">Admin REST API</a></li>
  <li><a href="../deploy/index.html" class="page">Deploy to production</a>
  <ul>
    <li><a href="../deploy/clustering.html" class="page">Otoroshi clustering</a></li>
    <li><a href="../deploy/kubernetes.html" class="page">Kubernetes</a></li>
    <li><a href="../deploy/clever-cloud.html" class="page">Clever-Cloud</a></li>
    <li><a href="../deploy/aws.html" class="page">AWS - Elastic Beanstalk</a></li>
    <li><a href="../deploy/scaling.html" class="page">Scaling Otoroshi</a></li>
  </ul></li>
  <li><a href="../dev.html" class="page">Developing Otoroshi</a></li>
  <li><a href="../search.html" class="page">Search otoroshi documentation</a></li>
</ul>
</div>

</nav>
</div>

<div class="off-canvas-content" data-off-canvas-content>

<div class="expanded row">

<div class="medium-3 large-2 show-for-medium column" style="height: 100dvh">
<nav class="site-nav">
<div class="title-logo"></div>
<div class="nav-home">
<a href="../index.html" >
<span class="home-icon">⌂</span>Otoroshi
</a>
<div class="version-number">
latest
</div>
</div>
<div class="nav-toc">
<ul>
  <li><a href="../about.html" class="page">About Otoroshi</a></li>
  <li><a href="../architecture.html" class="page">Architecture</a></li>
  <li><a href="../features.html" class="page">Features</a></li>
  <li><a href="../getting-started.html" class="page">Getting Started</a></li>
  <li><a href="../install/index.html" class="page">Install</a>
  <ul>
    <li><a href="../install/get-otoroshi.html" class="page">Get Otoroshi</a></li>
    <li><a href="../install/setup-otoroshi.html" class="page">Setup Otoroshi</a></li>
    <li><a href="../install/run-otoroshi.html" class="page">Run Otoroshi</a></li>
  </ul></li>
  <li><a href="../entities/index.html" class="page">Main entities</a>
  <ul>
    <li><a href="../entities/routes.html" class="page">Routes</a></li>
    <li><a href="../entities/apis.html" class="page">Apis</a></li>
    <li><a href="../entities/backends.html" class="page">Backends</a></li>
    <li><a href="../entities/organizations.html" class="page">Organizations</a></li>
    <li><a href="../entities/teams.html" class="page">Teams</a></li>
    <li><a href="../entities/global-config.html" class="page">Global config</a></li>
    <li><a href="../entities/apikeys.html" class="page">Apikeys</a></li>
    <li><a href="../entities/service-groups.html" class="page">Service groups</a></li>
    <li><a href="../entities/auth-modules.html" class="page">Authentication modules</a></li>
    <li><a href="../entities/certificates.html" class="page">Certificates</a></li>
    <li><a href="../entities/jwt-verifiers.html" class="page">JWT verifiers</a></li>
    <li><a href="../entities/data-exporters.html" class="page">Data exporters</a></li>
    <li><a href="../entities/scripts.html" class="page">Scripts</a></li>
    <li><a href="../entities/tcp-services.html" class="page">TCP services</a></li>
    <li><a href="../entities/service-descriptors.html" class="page">Service descriptors</a></li>
  </ul></li>
  <li><a href="../topics/index.html" class="page">Detailed topics</a>
  <ul>
    <li><a href="../topics/engine.html" class="page">Proxy engine</a></li>
    <li><a href="../topics/expression-language.html" class="page">Expression language</a></li>
    <li><a href="../topics/secrets.html" class="page">Secrets management</a></li>
    <li><a href="../topics/otoroshi-protocol.html" class="page">The Otoroshi communication protocol</a></li>
    <li><a href="../topics/tls.html" class="page">TLS</a></li>
    <li><a href="../topics/user-rights.html" class="page">Otoroshi user rights</a></li>
    <li><a href="../topics/events-and-analytics.html" class="page">Events and analytics</a></li>
    <li><a href="../topics/monitoring.html" class="page">Monitoring</a></li>
    <li><a href="../topics/sessions-mgmt.html" class="page">Sessions management</a></li>
    <li><a href="../topics/wasm-usage.html" class="page">Otoroshi and WASM</a></li>
    <li><a href="../topics/chaos-engineering.html" class="page">Chaos engineering with the Snow Monkey</a></li>
    <li><a href="../topics/pki.html" class="page">Otoroshi&rsquo;s PKI</a></li>
    <li><a href="../topics/dev-portal.html" class="page">Developer portal with Daikoku</a></li>
    <li><a href="../topics/graphql-composer.html" class="page">GraphQL Composer Plugin</a></li>
    <li><a href="../topics/tunnels.html" class="page">Otoroshi tunnels</a></li>
    <li><a href="../topics/relay-routing.html" class="page">Relay Routing</a></li>
    <li><a href="../topics/netty-server.html" class="page">Alternative HTTP server</a></li>
    <li><a href="../topics/http3.html" class="page">HTTP3 support</a></li>
    <li><a href="../topics/anonymous-reporting.html" class="page">Anonymous reporting</a></li>
    <li><a href="../topics/opentelemetry.html" class="page">OpenTelemetry support</a></li>
    <li><a href="../topics/green-score.html" class="page">Green Score</a></li>
    <li><a href="../topics/http-listeners.html" class="page">Custom HTTP Listeners</a></li>
    <li><a href="../topics/deprecating-sd.html" class="page">Sunsetting Service Descriptors</a></li>
    <li><a href="../topics/workflows.html" class="active page">Otoroshi Workflows</a></li>
  </ul></li>
  <li><a href="../how-to-s/index.html" class="page">How to&rsquo;s</a>
  <ul>
    <li><a href="../how-to-s/wasm-usage.html" class="page">Using wasm plugins</a></li>
    <li><a href="../how-to-s/wasmo-installation.html" class="page">Deploy your own Wasmo</a></li>
    <li><a href="../how-to-s/tailscale-integration.html" class="page">Tailscale integration</a></li>
    <li><a href="../how-to-s/end-to-end-mtls.html" class="page">End-to-end mTLS</a></li>
    <li><a href="../how-to-s/export-alerts-using-mailgun.html" class="page">Send alerts using mailgun</a></li>
    <li><a href="../how-to-s/export-events-to-elastic.html" class="page">Export events to Elasticsearch</a></li>
    <li><a href="../how-to-s/import-export-otoroshi-datastore.html" class="page">Import and export Otoroshi datastore</a></li>
    <li><a href="../how-to-s/secure-app-with-auth0.html" class="page">Secure an app with Auth0</a></li>
    <li><a href="../how-to-s/secure-app-with-keycloak.html" class="page">Secure an app with Keycloak</a></li>
    <li><a href="../how-to-s/secure-app-with-ldap.html" class="page">Secure an app and/or your Otoroshi UI with LDAP</a></li>
    <li><a href="../how-to-s/secure-with-apikey.html" class="page">Secure an api with api keys</a></li>
    <li><a href="../how-to-s/secure-with-oauth1-client.html" class="page">Secure an app with OAuth1 client flow</a></li>
    <li><a href="../how-to-s/secure-with-oauth2-client-credentials.html" class="page">Secure an app with OAuth2 client_credential flow</a></li>
    <li><a href="../how-to-s/setup-otoroshi-cluster.html" class="page">Setup an Otoroshi cluster</a></li>
    <li><a href="../how-to-s/tls-using-lets-encrypt.html" class="page">TLS termination using Let&rsquo;s Encrypt</a></li>
    <li><a href="../how-to-s/secure-an-app-with-jwt-verifiers.html" class="page">Secure an api with jwt verifiers</a></li>
    <li><a href="../how-to-s/secure-the-communication-between-a-backend-app-and-otoroshi.html" class="page">Secure the communication between a backend app and Otoroshi</a></li>
    <li><a href="../how-to-s/tls-termination-using-own-certificates.html" class="page">TLS termination using your own certificates</a></li>
    <li><a href="../how-to-s/resources-loader.html" class="page">The resources loader</a></li>
    <li><a href="../how-to-s/custom-log-levels.html" class="page">Log levels customization</a></li>
    <li><a href="../how-to-s/custom-initial-state.html" class="page">Initial state customization</a></li>
    <li><a href="../how-to-s/communicate-with-kafka.html" class="page">Communicate with Kafka</a></li>
    <li><a href="../how-to-s/create-custom-auth-module.html" class="page">Create your Authentication module</a></li>
    <li><a href="../how-to-s/working-with-eureka.html" class="page">Working with Eureka</a></li>
    <li><a href="../how-to-s/instantiate-waf-coraza.html" class="page">Instantiate a WAF with Coraza</a></li>
    <li><a href="../how-to-s/zip-backend-plugin.html" class="page">Quickly expose a website and static files</a></li>
    <li><a href="../how-to-s/calling-otoroshi-from-a-frontend.html" class="page">Calling Otoroshi from a Frontend</a></li>
  </ul></li>
  <li><a href="../plugins/index.html" class="page">Otoroshi plugins</a>
  <ul>
    <li><a href="../plugins/plugins.html" class="page">Otoroshi plugins system</a></li>
    <li><a href="../plugins/create-plugins.html" class="page">Create plugins</a></li>
    <li><a href="../plugins/built-in-plugins.html" class="page">Built-in plugins</a></li>
    <li><a href="../plugins/built-in-legacy-plugins.html" class="page">Built-in legacy plugins</a></li>
  </ul></li>
  <li><a href="../api.html" class="page">Admin REST API</a></li>
  <li><a href="../deploy/index.html" class="page">Deploy to production</a>
  <ul>
    <li><a href="../deploy/clustering.html" class="page">Otoroshi clustering</a></li>
    <li><a href="../deploy/kubernetes.html" class="page">Kubernetes</a></li>
    <li><a href="../deploy/clever-cloud.html" class="page">Clever-Cloud</a></li>
    <li><a href="../deploy/aws.html" class="page">AWS - Elastic Beanstalk</a></li>
    <li><a href="../deploy/scaling.html" class="page">Scaling Otoroshi</a></li>
  </ul></li>
  <li><a href="../dev.html" class="page">Developing Otoroshi</a></li>
  <li><a href="../search.html" class="page">Search otoroshi documentation</a></li>
</ul>
</div>

</nav>
</div>

<div class="small-12 medium-9 large-10 column with-responsive-left-padding-5-rem">

<header class="site-header expanded row">
<div class="small-12 column" style="padding: 0">
<a href="#" class="off-canvas-toggle hide-for-medium" data-toggle="off-canvas-menu"><svg class="svg-icon svg-icon-menu" version="1.1" id="Menu" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"> <path class="svg-icon-menu-path" fill="#53CDEC" d="M16.4,9H3.6C3.048,9,3,9.447,3,10c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,9.447,16.952,9,16.4,9z M16.4,13
H3.6C3.048,13,3,13.447,3,14c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,13.447,16.952,13,16.4,13z M3.6,7H16.4
C16.952,7,17,6.553,17,6c0-0.553-0.048-1-0.6-1H3.6C3.048,5,3,5.447,3,6C3,6.553,3.048,7,3.6,7z"/></svg>
</a>
<div class="title-wrapper">
<div class="title"><a href="../index.html">Otoroshi</a> <div>DOCS</div>
</div>
<!--
<a href="https://www.example.com" class="logo show-for-medium">logo</a>
-->
</div>
</header>

<section class="site-content">

<div class="page-header row">
<div class="medium-12 show-for-medium column">
<div class="nav-breadcrumbs">
<ul>
  <li><a href="../index.html">Otoroshi</a></li>
  <li><a href="../topics/index.html">Detailed topics</a></li>
  <li>Otoroshi Workflows</li>
</ul>
</div>
</div>
</div>

<div class="page-content row">
<div class="small-12 large-9 column" id="docs">
<h1><a href="#otoroshi-workflows" name="otoroshi-workflows" class="anchor"><span class="anchor-link"></span></a>Otoroshi Workflows</h1>
<p>Workflows in Otoroshi provide a powerful way to describe and execute sequences of logic using a JSON-based pseudo-language. Think of it as a lightweight alternative to tools like n8n or Apache NiFi — without the GUI (yet). Workflows let you orchestrate actions, transform data, trigger functions, and control flow based on conditional logic, all within the Otoroshi ecosystem.</p>
<h2><a href="#key-concepts" name="key-concepts" class="anchor"><span class="anchor-link"></span></a>Key Concepts</h2>
<p>There are three primary building blocks:</p>
<ul>
  <li><strong>Nodes</strong>: The execution units that form the workflow steps.</li>
  <li><strong>Functions</strong>: Reusable logic units that can be invoked by <code>call</code> nodes.</li>
  <li><strong>Operators</strong>: Data transformation helpers that let you compute, compare, transform, and extract values within the workflow.</li>
</ul>
<p>Otoroshi comes with a set of default implementations, but you can easily extend workflows with custom plugins:</p>
<pre class="prettyprint"><code class="language-scala">WorkflowFunction.registerFunction(&quot;custom.function&quot;, new MyFunction())
Node.registerNode(&quot;custom-node&quot;, new MyNode())
WorkflowOperator.registerOperator(&quot;$custom_op&quot;, new MyOperator())
</code></pre>
<h2><a href="#basic-example" name="basic-example" class="anchor"><span class="anchor-link"></span></a>Basic Example</h2>
<pre class="prettyprint"><code class="language-json">{
  &quot;kind&quot;: &quot;workflow&quot;,
  &quot;steps&quot;: [
    {
      &quot;kind&quot;: &quot;call&quot;,
      &quot;description&quot;: &quot;Say hello to the name passed as input&quot;,
      &quot;function&quot;: &quot;core.hello&quot;,
      &quot;args&quot;: {
        &quot;name&quot;: &quot;${input.name}&quot;
      },
      &quot;result&quot;: &quot;call_res&quot;
    }
  ],
  &quot;returned&quot;: {
    &quot;$mem_ref&quot;: {
      &quot;name&quot;: &quot;call_res&quot;
    }
  }
}
</code></pre>
<p>Input:</p>
<pre class="prettyprint"><code class="language-json">{
  &quot;name&quot;: &quot;foo&quot;
}
</code></pre>
<p>Output:</p>
<pre class="prettyprint"><code class="language-json">{
  &quot;returned&quot;: &quot;Hello foo !&quot;,
  &quot;error&quot;: null
}
</code></pre>
<p>Memory state:</p>
<pre class="prettyprint"><code class="language-json">{
  &quot;call_res&quot;: &quot;Hello foo !&quot;,
  &quot;input&quot;: {
    &quot;name&quot;: &quot;foo&quot;
  }
}
</code></pre>
<h2><a href="#memory" name="memory" class="anchor"><span class="anchor-link"></span></a>Memory</h2>
<p>Each workflow execution comes with its own <strong>memory</strong>, where variables can be read from or written to. This memory enables communication between steps.</p>
<p>The <code>assign</code> node lets you manipulate memory directly, often combined with operators to compute values.</p>
<hr/>
<h2><a href="#nodes" name="nodes" class="anchor"><span class="anchor-link"></span></a>Nodes</h2>
<p>Each node must declare a <code>kind</code> field and can optionally define:</p>
<ul>
  <li><code>id</code>: Node identifier</li>
  <li><code>description</code>: A comment for readability/debugging</li>
  <li><code>enabled</code>: Boolean to toggle the node</li>
  <li><code>result</code>: Name of memory variable to store output</li>
  <li><code>returned</code>: Immediate result to return from the workflow</li>
</ul>
<h3><a href="#available-node-kinds-and-prototypes" name="available-node-kinds-and-prototypes" class="anchor"><span class="anchor-link"></span></a>Available Node Kinds and Prototypes</h3>
<h4><a href="#workflow" name="workflow" class="anchor"><span class="anchor-link"></span></a><code>workflow</code></h4>
<pre class="prettyprint"><code class="language-json">{
  &quot;kind&quot;: &quot;workflow&quot;,
  &quot;steps&quot;: [ &lt;Node&gt; ],
  &quot;returned&quot;: &lt;Value&gt;
}
</code></pre>
<h4><a href="#call" name="call" class="anchor"><span class="anchor-link"></span></a><code>call</code></h4>
<pre class="prettyprint"><code class="language-json">{
  &quot;kind&quot;: &quot;call&quot;,
  &quot;function&quot;: &quot;&lt;function_name&gt;&quot;,
  &quot;args&quot;: { ... },
  &quot;result&quot;: &quot;&lt;memory_var_name&gt;&quot;
}
</code></pre>
<h4><a href="#assign" name="assign" class="anchor"><span class="anchor-link"></span></a><code>assign</code></h4>
<pre class="prettyprint"><code class="language-json">{
  &quot;kind&quot;: &quot;assign&quot;,
  &quot;values&quot;: [
    {
      &quot;name&quot;: &quot;&lt;memory_var&gt;&quot;,
      &quot;value&quot;: &lt;any&gt;
    }
  ]
}
</code></pre>
<h4><a href="#parallel" name="parallel" class="anchor"><span class="anchor-link"></span></a><code>parallel</code></h4>
<pre class="prettyprint"><code class="language-json">{
  &quot;kind&quot;: &quot;parallel&quot;,
  &quot;paths&quot;: [ &lt;workflow&gt;, ... ]
}
</code></pre>
<h4><a href="#switch" name="switch" class="anchor"><span class="anchor-link"></span></a><code>switch</code></h4>
<pre class="prettyprint"><code class="language-json">{
  &quot;kind&quot;: &quot;switch&quot;,
  &quot;paths&quot;: [
    {
      &quot;predicate&quot;: &lt;bool_expr&gt;,
      &quot;node&quot;: &lt;workflow&gt;
    }
  ]
}
</code></pre>
<h4><a href="#if" name="if" class="anchor"><span class="anchor-link"></span></a><code>if</code></h4>
<pre class="prettyprint"><code class="language-json">{
  &quot;kind&quot;: &quot;if&quot;,
  &quot;predicate&quot;: &lt;bool_expr&gt;,
  &quot;then&quot;: &lt;Node&gt;,
  &quot;else&quot;: &lt;Node&gt;
}
</code></pre>
<h4><a href="#foreach-map-filter-flatmap" name="foreach-map-filter-flatmap" class="anchor"><span class="anchor-link"></span></a><code>foreach</code> / <code>map</code> / <code>filter</code> / <code>flatmap</code></h4>
<pre class="prettyprint"><code class="language-json">{
  &quot;kind&quot;: &quot;foreach&quot;,
  &quot;values&quot;: &lt;array_expr&gt;,
  &quot;node&quot;: &lt;workflow&gt;
}
</code></pre>
<h4><a href="#wait" name="wait" class="anchor"><span class="anchor-link"></span></a><code>wait</code></h4>
<pre class="prettyprint"><code class="language-json">{
  &quot;kind&quot;: &quot;wait&quot;,
  &quot;duration&quot;: 1000
}
</code></pre>
<h4><a href="#error" name="error" class="anchor"><span class="anchor-link"></span></a><code>error</code></h4>
<pre class="prettyprint"><code class="language-json">{
  &quot;kind&quot;: &quot;error&quot;,
  &quot;message&quot;: &quot;&lt;error_message&gt;&quot;,
  &quot;details&quot;: { ... }
}
</code></pre>
<hr/>
<h2><a href="#functions" name="functions" class="anchor"><span class="anchor-link"></span></a>Functions</h2>
<p>Workflow functions are reusable logic blocks invoked via <code>call</code> nodes.</p>
<p>Prototype:</p>
<pre class="prettyprint"><code class="language-json">{
  &quot;kind&quot;: &quot;call&quot;,
  &quot;function&quot;: &quot;&lt;function_name&gt;&quot;,
  &quot;args&quot;: { ... },
  &quot;result&quot;: &quot;&lt;memory_var_name&gt;&quot;
}
</code></pre>
<p>Built-in core functions include:</p>
<ul>
  <li><code>core.log</code>: { message: string, params?: array }</li>
  <li><code>core.hello</code>: { name: string }</li>
  <li><code>core.http_client</code>: { method, url, headers, body, timeout, tls_config }</li>
  <li><code>core.system_call</code>: { command: [string] }</li>
  <li><code>core.workflow_call</code>: { workflow_id: string, input: object }</li>
  <li><code>core.wasm_call</code>: { wasm_plugin, function?, params }</li>
  <li><code>core.file_read</code>: { path: string, parse_json?, encode_base64? }</li>
  <li><code>core.file_write</code>: { path?, value, prettify?, from_base64? }</li>
  <li><code>core.send_mail</code>: { from, to, subject, html, mailer_config }</li>
  <li><code>core.store_get</code>, <code>store_set</code>, <code>store_del</code>: { key, value?, ttl? }</li>
  <li><code>core.emit_event</code>: { event: object }</li>
</ul>
<hr/>
<h2><a href="#operators" name="operators" class="anchor"><span class="anchor-link"></span></a>Operators</h2>
<p>Operators are one-key JSON objects (e.g. <code>{ &quot;$eq&quot;: { ... } }</code>) used to manipulate data. They can:</p>
<ul>
  <li>Navigate and extract memory (<code>$mem_ref</code>)</li>
  <li>Transform strings (<code>$str_concat</code>, <code>$encode_base64</code>, <code>$decode_base64</code>)</li>
  <li>Compare values (<code>$eq</code>, <code>$gt</code>, <code>$lt</code>, <code>$gte</code>, <code>$lte</code>, <code>$neq</code>)</li>
  <li>Evaluate truthiness (<code>$is_truthy</code>, <code>$is_falsy</code>, <code>$not</code>)</li>
  <li>Work with arrays/maps (<code>$array_append</code>, <code>$array_prepend</code>, <code>$array_at</code>, <code>$array_del</code>, <code>$array_page</code>, <code>$map_get</code>, <code>$map_put</code>, <code>$map_del</code>)</li>
  <li>Perform math (<code>$add</code>, <code>$subtract</code>, <code>$multiply</code>, <code>$divide</code>)</li>
  <li>Parse and format dates/times (<code>$parse_datetime</code>, <code>$parse_date</code>, <code>$parse_time</code>, <code>$now</code>)</li>
  <li>Parse and project JSON (<code>$json_parse</code>, <code>$projection</code>)</li>
  <li>Perform expression evaluation (<code>$expression_language</code>)</li>
  <li>Create auth headers (<code>$basic_auth</code>)</li>
  <li>Check containment (<code>$contains</code>)</li>
</ul>
<h3><a href="#full-list-of-operators" name="full-list-of-operators" class="anchor"><span class="anchor-link"></span></a>Full List of Operators</h3>
<ul>
  <li><code>$mem_ref</code></li>
  <li><code>$array_append</code></li>
  <li><code>$array_prepend</code></li>
  <li><code>$array_at</code></li>
  <li><code>$array_del</code></li>
  <li><code>$array_page</code></li>
  <li><code>$projection</code></li>
  <li><code>$map_put</code></li>
  <li><code>$map_get</code></li>
  <li><code>$map_del</code></li>
  <li><code>$json_parse</code></li>
  <li><code>$str_concat</code></li>
  <li><code>$is_truthy</code></li>
  <li><code>$is_falsy</code></li>
  <li><code>$contains</code></li>
  <li><code>$eq</code></li>
  <li><code>$neq</code></li>
  <li><code>$gt</code></li>
  <li><code>$lt</code></li>
  <li><code>$gte</code></li>
  <li><code>$lte</code></li>
  <li><code>$encode_base64</code></li>
  <li><code>$decode_base64</code></li>
  <li><code>$basic_auth</code></li>
  <li><code>$now</code></li>
  <li><code>$not</code></li>
  <li><code>$parse_datetime</code></li>
  <li><code>$parse_date</code></li>
  <li><code>$parse_time</code></li>
  <li><code>$add</code></li>
  <li><code>$subtract</code></li>
  <li><code>$multiply</code></li>
  <li><code>$divide</code></li>
  <li><code>$expression_language</code></li>
</ul>
<hr/>
<h2><a href="#plugins" name="plugins" class="anchor"><span class="anchor-link"></span></a>Plugins</h2>
<p>Workflows can be used inside routes using:</p>
<ul>
  <li><code>WorkflowBackend</code>: Use a workflow as backend handler</li>
  <li><code>WorkflowRequestTransformer</code> / <code>WorkflowResponseTransformer</code>: Mutate requests/responses</li>
  <li><code>WorkflowAccessValidator</code>: Validate access with workflow logic</li>
</ul>
<hr/>
<h2><a href="#examples" name="examples" class="anchor"><span class="anchor-link"></span></a>Examples</h2>
<h3><a href="#time-based-query-validator" name="time-based-query-validator" class="anchor"><span class="anchor-link"></span></a>Time-based Query Validator</h3>
<pre class="prettyprint"><code class="language-json">{
  &quot;kind&quot;: &quot;workflow&quot;,
  &quot;description&quot;: &quot;this workflow is supposed to be used in a WorkflowAccessValidator scenario where a request can pass if one of its query param if before a datetime&quot;,
  &quot;steps&quot;: [
    {
      &quot;description&quot;: &quot;extract date from request query params, and compute max possible datetime&quot;,
      &quot;kind&quot;: &quot;assign&quot;,
      &quot;values&quot;: [
        {
          &quot;name&quot;: &quot;query_date&quot;,
          &quot;value&quot;: {
            &quot;$parse_datetime&quot;: {
              &quot;value&quot;: &quot;${input.request.query.date.0}&quot;
            }
          }
        },
        {
          &quot;name&quot;: &quot;max_date&quot;,
          &quot;value&quot;: {
            &quot;$add&quot;: {
              &quot;values&quot;: [&quot;${now}&quot;, 7200000]
            }
          }
        }
      ]
    },
    {
      &quot;kind&quot;: &quot;if&quot;,
      &quot;description&quot;: &quot;check if extracted date is before max date&quot;,
      &quot;predicate&quot;: {
        &quot;$lte&quot;: {
          &quot;a&quot;: &quot;${query_date}&quot;,
          &quot;b&quot;: &quot;${max_date}&quot;
        }
      },
      &quot;then&quot;: {
        &quot;kind&quot;: &quot;assign&quot;,
        &quot;description&quot;: &quot;if so, let the call pass&quot;,
        &quot;values&quot;: [
          {
            &quot;name&quot;: &quot;call_res&quot;,
            &quot;value&quot;: {
              &quot;result&quot;: true,
              &quot;error&quot;: null
            }
          }
        ]
      },
      &quot;else&quot;: {
        &quot;kind&quot;: &quot;assign&quot;,
        &quot;description&quot;: &quot;if not, show error&quot;,  
        &quot;values&quot;: [
          {
            &quot;name&quot;: &quot;call_res&quot;,
            &quot;value&quot;: {
              &quot;result&quot;: false,
              &quot;error&quot;: {
                &quot;status&quot;: 400,
                &quot;message&quot;: &quot;Bad query param value&quot;
              }
            }
          }
        ]
      }
    }
  ],
  &quot;returned&quot;: {
    &quot;$mem_ref&quot;: {
      &quot;name&quot;: &quot;call_res&quot;
    }
  }
}
</code></pre>
<p>run at <code>2025-06-04T11:48:00.000</code> with input like:</p>
<pre class="prettyprint"><code class="language-json">{
  &quot;request&quot;: {
    &quot;query&quot;: {
      &quot;date&quot;: [
        &quot;2025-06-04T11:00:00.000&quot;
      ]
    }
  }
}
</code></pre>
<p>the result:</p>
<pre class="prettyprint"><code class="language-json">{
  &quot;returned&quot;: {
    &quot;result&quot;: true,
    &quot;error&quot;: null
  },
  &quot;error&quot;: null
}
</code></pre>
<p>the memory content: </p>
<pre class="prettyprint"><code class="language-json">{
  &quot;query_date&quot;: 1749027600000,
  &quot;call_res&quot;: {
    &quot;result&quot;: true,
    &quot;error&quot;: null
  },
  &quot;max_date&quot;: 1749037738115,
  &quot;input&quot;: {
    &quot;request&quot;: {
      &quot;query&quot;: {
        &quot;date&quot;: [
          &quot;2025-06-04T11:00:00.000&quot;
        ]
      }
    }
  }
}
</code></pre>
<p>run at <code>2025-06-04T11:48:00.000</code> with input like:</p>
<pre class="prettyprint"><code class="language-json">{
  &quot;request&quot;: {
    &quot;query&quot;: {
      &quot;date&quot;: [
        &quot;2025-06-04T18:00:00.000&quot;
      ]
    }
  }
}
</code></pre>
<p>the result:</p>
<pre class="prettyprint"><code class="language-json">{
  &quot;returned&quot;: {
    &quot;result&quot;: false,
    &quot;error&quot;: {
      &quot;status&quot;: 400,
      &quot;message&quot;: &quot;Bad query param value&quot;
    }
  },
  &quot;error&quot;: null
}
</code></pre>
<p>the memory content: </p>
<pre class="prettyprint"><code class="language-json">{
  &quot;query_date&quot;: 1749052800000,
  &quot;call_res&quot;: {
    &quot;result&quot;: false,
    &quot;error&quot;: {
      &quot;status&quot;: 400,
      &quot;message&quot;: &quot;Bad query param value&quot;
    }
  },
  &quot;max_date&quot;: 1749037844696,
  &quot;input&quot;: {
    &quot;request&quot;: {
      &quot;query&quot;: {
        &quot;date&quot;: [
          &quot;2025-06-04T18:00:00.000&quot;
        ]
      }
    }
  }
}
</code></pre>
<h3><a href="#api-consumer-transformer" name="api-consumer-transformer" class="anchor"><span class="anchor-link"></span></a>API Consumer &amp; Transformer</h3>
<pre class="prettyprint"><code class="language-json">{
  &quot;kind&quot;: &quot;workflow&quot;,
  &quot;steps&quot;: [
    {
      &quot;kind&quot;: &quot;call&quot;,
      &quot;description&quot;: &quot;get all pokemons from the pokeapi&quot;,
      &quot;function&quot;: &quot;core.http_client&quot;,
      &quot;args&quot;: {
        &quot;method&quot;: &quot;GET&quot;,
        &quot;url&quot;: &quot;https://pokeapi.co/api/v2/pokemon&quot;
      },
      &quot;result&quot;: &quot;pokemons&quot;
    },
    {
      &quot;kind&quot;: &quot;assign&quot;,
      &quot;description&quot;: &quot;extract results from the response, and only keep the 5 first pokemons&quot;,
      &quot;values&quot;: [
        {
          &quot;name&quot;: &quot;pokemons&quot;,
          &quot;value&quot;: {
            &quot;$array_page&quot;: {
              &quot;array&quot;: &quot;${pokemons.body_json.results}&quot;,
              &quot;page&quot;: 1,
              &quot;page_size&quot;: 5
            }
          }
        },
        {
          &quot;name&quot;: &quot;pokemon_names&quot;,
          &quot;value&quot;: []
        }
      ]
    },
    {
      &quot;kind&quot;: &quot;map&quot;,
      &quot;description&quot;: &quot;for each pokemon, just extract its name&quot;,
      &quot;values&quot;: &quot;${pokemons}&quot;,
      &quot;node&quot;: {
        &quot;kind&quot;: &quot;assign&quot;,
        &quot;values&quot;: [
          {
            &quot;name&quot;: &quot;pokemon_names&quot;,
            &quot;value&quot;: {
              &quot;$array_append&quot;: {
                &quot;array&quot;: &quot;${pokemon_names}&quot;,
                &quot;value&quot;: &quot;${foreach_value.name}&quot;
              }
            }
          }
        ]
      }
    }
  ],
  &quot;returned&quot;: {
    &quot;$mem_ref&quot;: {
      &quot;name&quot;: &quot;pokemon_names&quot;
    }
  }
}
</code></pre>
<p>the result:</p>
<pre class="prettyprint"><code class="language-json">{
  &quot;returned&quot;: [
    &quot;charizard&quot;,
    &quot;squirtle&quot;,
    &quot;wartortle&quot;,
    &quot;blastoise&quot;,
    &quot;caterpie&quot;
  ],
  &quot;error&quot;: null
}
</code></pre>
<p>the memory content:</p>
<pre class="prettyprint"><code class="language-json">{
  &quot;pokemons&quot;: [
    {
      &quot;name&quot;: &quot;charizard&quot;,
      &quot;url&quot;: &quot;https://pokeapi.co/api/v2/pokemon/6/&quot;
    },
    {
      &quot;name&quot;: &quot;squirtle&quot;,
      &quot;url&quot;: &quot;https://pokeapi.co/api/v2/pokemon/7/&quot;
    },
    {
      &quot;name&quot;: &quot;wartortle&quot;,
      &quot;url&quot;: &quot;https://pokeapi.co/api/v2/pokemon/8/&quot;
    },
    {
      &quot;name&quot;: &quot;blastoise&quot;,
      &quot;url&quot;: &quot;https://pokeapi.co/api/v2/pokemon/9/&quot;
    },
    {
      &quot;name&quot;: &quot;caterpie&quot;,
      &quot;url&quot;: &quot;https://pokeapi.co/api/v2/pokemon/10/&quot;
    }
  ],
  &quot;pokemon_names&quot;: [
    &quot;charizard&quot;,
    &quot;squirtle&quot;,
    &quot;wartortle&quot;,
    &quot;blastoise&quot;,
    &quot;caterpie&quot;
  ],
  &quot;input&quot;: {}
}
</code></pre>
<h3><a href="#ai-agent" name="ai-agent" class="anchor"><span class="anchor-link"></span></a>AI Agent</h3>
<p>An AI agent with persistent memory, tools and that can support audio as input and output, using the <a href="https://cloud-apim.github.io/otoroshi-llm-extension/">Cloud API Otoroshi LLM Extension</a>. This workflow can be used from a <code>WorkflowBackend</code> plugin.</p>
<pre class="prettyprint"><code class="language-json">{
  &quot;id&quot;: &quot;main&quot;,
  &quot;kind&quot;: &quot;workflow&quot;,
  &quot;steps&quot;: [
    {
      &quot;description&quot;: &quot;check if input is audio or text&quot;,
      &quot;kind&quot;: &quot;if&quot;,
      &quot;predicate&quot;: {
        &quot;$is_truthy&quot;: {
          &quot;value&quot;: &quot;${input.request.body_json.audio}&quot;
        }
      },
      &quot;then&quot;: {
        &quot;description&quot;: &quot;if audio, transform to text&quot;,
        &quot;kind&quot;: &quot;call&quot;,
        &quot;function&quot;: &quot;extensions.com.cloud-apim.llm-extension.audio_stt&quot;,
        &quot;args&quot;: {
          &quot;provider&quot;: &quot;audio-model_openai&quot;,
          &quot;decode_base64&quot;: true,
          &quot;payload&quot;: {
            &quot;model&quot;: &quot;gpt-4o-mini-transcribe&quot;,
            &quot;audio&quot;: &quot;${input.request.body_json.audio}&quot;
          }
        },
        &quot;result&quot;: &quot;input_text&quot;
      },
      &quot;else&quot;: {
        &quot;description&quot;: &quot;if not audio, just assign in memory&quot;,
        &quot;kind&quot;: &quot;assign&quot;,
        &quot;values&quot;: [
          {
            &quot;name&quot;: &quot;input_text&quot;,
            &quot;value&quot;: &quot;${input.request.body_json.text}&quot;
          }
        ]
      }
    },
    {
      &quot;description&quot;: &quot;call the first llm with all the context, memory and tool needed like websearch, URL wrawling, etc to get a first raw response&quot;,
      &quot;kind&quot;: &quot;call&quot;,
      &quot;function&quot;: &quot;extensions.com.cloud-apim.llm-extension.llm_call&quot;,
      &quot;args&quot;: {
        &quot;provider&quot;: &quot;provider_openai&quot;,
        &quot;openai_format&quot;: false,
        &quot;memory&quot;: &quot;persistent-memory_local&quot;,
        &quot;tool_functions&quot;: [
          &quot;tool-function_site2md&quot;,
          &quot;tool-function_websearch&quot;
        ],
        &quot;payload&quot;: {
          &quot;model&quot;: &quot;gpt-4o&quot;,
          &quot;max_tokens&quot;: 3000,
          &quot;messages&quot;: [
            {
              &quot;role&quot;: &quot;system&quot;,
              &quot;content&quot;: &quot;You are a smart, reliable, organized, and proactive personal assistant. You assist a user named Foo, an experienced software engineer, in managing his daily tasks, technical projects, creative ideas, as well as personal and family needs.\\n\\nYou are able to:\\n\\nOrganize ideas, projects, tasks, reminders, and priorities.\\n\\nProvide technical advice (backend, frontend, DevOps, AI, APIs, cybersecurity…).\\n\\nSuggest solutions or tools to save time.\\n\\nRespond with empathy, clarity, and efficiency.\\n\\nGenerate useful content (emails, scripts, messages, ideas, to-do lists…).\\n\\nMaintain a professional yet human tone, with a touch of light humor or camaraderie when appropriate.\\n\\nYour answers should be:\\n\\nConcise when brevity is requested.\\n\\nDetailed and structured when needed.\\n\\nAction-oriented, with concrete suggestions.\\n\\nYou may ask Foo questions to clarify his requests or anticipate his needs. You are available at all times, but never intrusive. Today’s date is ${now_str}.&quot;
            },
            {
              &quot;role&quot;: &quot;user&quot;,
              &quot;content&quot;: &quot;${input_text}&quot;
            }
          ]
        }
      },
      &quot;result&quot;: &quot;agent-1&quot;
    },
    {
      &quot;description&quot;: &quot;extract the text response from the LLM API response&quot;,
      &quot;kind&quot;: &quot;assign&quot;,
      &quot;values&quot;: [
        {
          &quot;name&quot;: &quot;agent-1&quot;,
          &quot;value&quot;: {
            &quot;$mem_ref&quot;: {
              &quot;name&quot;: &quot;agent-1&quot;,
              &quot;path&quot;: &quot;generations.0.message.content&quot;
            }
          }
        }
      ]
    },
    {
      &quot;description&quot;: &quot;now, ask a second LLM model to rewrite the raw response with an agent personnality&quot;,
      &quot;kind&quot;: &quot;call&quot;,
      &quot;function&quot;: &quot;extensions.com.cloud-apim.llm-extension.llm_call&quot;,
      &quot;args&quot;: {
        &quot;provider&quot;: &quot;provider_openai&quot;,
        &quot;openai_format&quot;: false,
        &quot;payload&quot;: {
          &quot;model&quot;: &quot;gpt-4o-mini&quot;,
          &quot;max_tokens&quot;: 500,
          &quot;messages&quot;: [
            {
              &quot;role&quot;: &quot;system&quot;,
              &quot;content&quot;: &quot;You are Jarvis, the personal AI assistant of Mister Foo. You embody an exceptional English butler — impeccably professional, unflappably composed, and sharply intelligent. Your tone is calm, polite, elegant, often subtly ironic, and always remarkably precise.\\n\\nYour task is to take the raw response from a primary AI assistant and:\\n\\nSummarize or rephrase it clearly and concisely, in the briefest form possible.\\n\\nExpress it in a tone worthy of an English butler, inspired by Jarvis from Iron Man.\\n\\nSubtly add refined touches of irony or wit where appropriate.\\n\\nFormat the response so that it is readable, pleasant, and effective.\\n\\nYou do not answer the user&#39;s original question directly: you narrate and synthesize what the other assistant said — but with flair. Do not mention the previous assistant; the response must appear to come from you.\\n\\nFor example, if the raw AI gives a long technical explanation, you may conclude your summary with:\\n\&quot;In short, Sir, should you embark on this path, I suggest preparing some tea and a comfortable chair.\&quot;\\n\\nA few stylistic rules:\\n\\nNever be casual or coarse.\\n\\nAlways prioritize elegance of expression.\\n\\nNever invent technical content — only reformulate what was given to you.\\n\\nIf the original response is too long, condense it into one or two essential points. But do not number them (1., 2.); instead, connect the ideas naturally as a proper English butler would.\\n\\nIn all circumstances, you are precise, loyal, discreet.&quot;
            },
            {
              &quot;role&quot;: &quot;user&quot;,
              &quot;content&quot;: &quot;${agent-1}&quot;
            }
          ]
        }
      },
      &quot;result&quot;: &quot;jarvis&quot;
    },
    {
      &quot;description&quot;: &quot;extract the text response from the LLM API response&quot;,
      &quot;kind&quot;: &quot;assign&quot;,
      &quot;values&quot;: [
        {
          &quot;name&quot;: &quot;jarvis&quot;,
          &quot;value&quot;: {
            &quot;$mem_ref&quot;: {
              &quot;name&quot;: &quot;jarvis&quot;,
              &quot;path&quot;: &quot;generations.0.message.content&quot;
            }
          }
        }
      ]
    },
    {
      &quot;description&quot;: &quot;transform jarvis response to audio&quot;,
      &quot;kind&quot;: &quot;call&quot;,
      &quot;function&quot;: &quot;extensions.com.cloud-apim.llm-extension.audio_tts&quot;,
      &quot;args&quot;: {
        &quot;provider&quot;: &quot;audio-model_openai&quot;,
        &quot;payload&quot;: {
          &quot;input&quot;: &quot;${jarvis}&quot;,
          &quot;voice&quot;: &quot;echo&quot;,
          &quot;instructions&quot;: &quot;parle comme un majordome anglais zélé et flegmatique&quot;,
          &quot;model&quot;: &quot;gpt-4o-mini-tts&quot;,
          &quot;speed&quot;: 1.2
        },
        &quot;encode_base64&quot;: true
      },
      &quot;result&quot;: &quot;audio_base64&quot;
    },
    {
      &quot;description&quot;: &quot;write the audio as file, used for local debug only&quot;,
      &quot;kind&quot;: &quot;call&quot;,
      &quot;function&quot;: &quot;core.file_write&quot;,
      &quot;enabled&quot;: false,
      &quot;args&quot;: {
        &quot;value&quot;: &quot;${audio_base64.base64}&quot;,
        &quot;from_base64&quot;: true
      },
      &quot;result&quot;: &quot;audio_file&quot;
    },
    {
      &quot;description&quot;: &quot;create the http respond that will be send back to the consumer, containing the audio file base64 encoded&quot;,
      &quot;kind&quot;: &quot;assign&quot;,
      &quot;values&quot;: [
        {
          &quot;name&quot;: &quot;call_res&quot;,
          &quot;value&quot;: {
            &quot;status&quot;: 200,
            &quot;headers&quot;: {
              &quot;Content-Type&quot;: &quot;application/json&quot;
            },
            &quot;body_json&quot;: {
              &quot;text&quot;: &quot;${jarvis}&quot;,
              &quot;audio_base64&quot;: &quot;${audio_base64}&quot;
            }
          }
        }
      ]
    },
    {
      &quot;description&quot;: &quot;play the audio file using VLC, used for local debug only&quot;,
      &quot;kind&quot;: &quot;call&quot;,
      &quot;function&quot;: &quot;core.system_call&quot;,
      &quot;enabled&quot;: false,
      &quot;args&quot;: {
        &quot;command&quot;: [
          &quot;open&quot;,
          &quot;-a&quot;,
          &quot;VLC&quot;,
          &quot;${audio_file.file_path}&quot;
        ]
      },
      &quot;result&quot;: &quot;play&quot;
    }
  ],
  &quot;returned&quot;: {
    &quot;$mem_ref&quot;: {
      &quot;name&quot;: &quot;call_res&quot;
    }
  }
}
</code></pre>
<p>with the associated resources to make it work: </p>
<pre class="prettyprint"><code class="language-json">{
  &quot;_loc&quot;: {
    &quot;tenant&quot;: &quot;default&quot;,
    &quot;teams&quot;: [
      &quot;default&quot;
    ]
  },
  &quot;id&quot;: &quot;tool-function_websearch&quot;,
  &quot;name&quot;: &quot;websearch&quot;,
  &quot;description&quot;: &quot;This function can be used to search the web on whatever topic you need. Like \&quot;what new today ?\&quot; or \&quot;can you make some research about xxx\&quot; etc&quot;,
  &quot;metadata&quot;: {},
  &quot;tags&quot;: [],
  &quot;strict&quot;: true,
  &quot;parameters&quot;: {
    &quot;query&quot;: {
      &quot;type&quot;: &quot;string&quot;,
      &quot;description&quot;: &quot;The search query&quot;
    }
  },
  &quot;required&quot;: null,
  &quot;backend&quot;: {
    &quot;kind&quot;: &quot;Http&quot;,
    &quot;options&quot;: {
      &quot;url&quot;: &quot;https://api.openai.com/v1/responses&quot;,
      &quot;method&quot;: &quot;POST&quot;,
      &quot;body&quot;: &quot;{\n  \&quot;model\&quot;: \&quot;gpt-4.1\&quot;,\n  \&quot;tools\&quot;: [{\&quot;type\&quot;: \&quot;web_search_preview\&quot;}],\n  \&quot;input\&quot;: \&quot;${query}\&quot;\n}&quot;,
      &quot;headers&quot;: {
        &quot;Content-Type&quot;: &quot;application/json&quot;,
        &quot;Authorization&quot;: &quot;Bearer ${vault://local/openai-token}&quot;
      },
      &quot;response_at&quot;: &quot;output.1.content.0.text&quot;
    }
  },
  &quot;kind&quot;: &quot;ai-gateway.extensions.cloud-apim.com/ToolFunction&quot;
}
</code></pre>
<pre class="prettyprint"><code class="language-json">{
  &quot;_loc&quot;: {
    &quot;tenant&quot;: &quot;default&quot;,
    &quot;teams&quot;: [
      &quot;default&quot;
    ]
  },
  &quot;id&quot;: &quot;tool-function_site2md&quot;,
  &quot;name&quot;: &quot;site2md&quot;,
  &quot;description&quot;: &quot;This function can be used to fetch the content of an url, a webpage. The content of the page will be returned as markdown for better llm readability. It can be used to summarize the content of a page like \&quot;hey, tell me what&#39;s on https://site2md.com/\&quot;&quot;,
  &quot;metadata&quot;: {},
  &quot;tags&quot;: [],
  &quot;strict&quot;: true,
  &quot;parameters&quot;: {
    &quot;user_url&quot;: {
      &quot;type&quot;: &quot;string&quot;,
      &quot;description&quot;: &quot;The URL of the webpage to fetch&quot;
    }
  },
  &quot;required&quot;: null,
  &quot;backend&quot;: {
    &quot;kind&quot;: &quot;Http&quot;,
    &quot;options&quot;: {
      &quot;method&quot;: &quot;GET&quot;,
      &quot;url&quot;: &quot;https://site2md.com/${user_url}&quot;
    }
  },
  &quot;kind&quot;: &quot;ai-gateway.extensions.cloud-apim.com/ToolFunction&quot;
}
</code></pre>
<pre class="prettyprint"><code class="language-json">{
  &quot;_loc&quot;: {
    &quot;tenant&quot;: &quot;default&quot;,
    &quot;teams&quot;: [
      &quot;default&quot;
    ]
  },
  &quot;id&quot;: &quot;audio-model_openai&quot;,
  &quot;name&quot;: &quot;Audio model&quot;,
  &quot;description&quot;: &quot;An audio model&quot;,
  &quot;metadata&quot;: {},
  &quot;tags&quot;: [],
  &quot;provider&quot;: &quot;openai&quot;,
  &quot;config&quot;: {
    &quot;connection&quot;: {
      &quot;token&quot;: &quot;${vault://local/openai-token}&quot;,
      &quot;timeout&quot;: 30000
    },
    &quot;options&quot;: {
      &quot;tts&quot;: {
        &quot;model&quot;: &quot;gpt-4o-mini-tts&quot;,
        &quot;response_format&quot;: &quot;mp3&quot;,
        &quot;speed&quot;: 1
      },
      &quot;stt&quot;: {
        &quot;model&quot;: &quot;gpt-4o-mini-transcribe&quot;
      }
    }
  },
  &quot;kind&quot;: &quot;ai-gateway.extensions.cloud-apim.com/AudioModel&quot;
}
</code></pre>
<pre class="prettyprint"><code class="language-json">{
  &quot;_loc&quot;: {
    &quot;tenant&quot;: &quot;default&quot;,
    &quot;teams&quot;: [
      &quot;default&quot;
    ]
  },
  &quot;id&quot;: &quot;provider_openai&quot;,
  &quot;name&quot;: &quot;OpenAI clean&quot;,
  &quot;description&quot;: &quot;An OpenAI LLM api provider&quot;,
  &quot;metadata&quot;: {},
  &quot;tags&quot;: [],
  &quot;provider&quot;: &quot;openai&quot;,
  &quot;connection&quot;: {
    &quot;base_url&quot;: &quot;https://api.openai.com/v1&quot;,
    &quot;token&quot;: &quot;${vault://local/openai-token}&quot;,
    &quot;timeout&quot;: 30000
  },
  &quot;options&quot;: {
    &quot;model&quot;: &quot;gpt-4o-mini&quot;,
    &quot;frequency_penalty&quot;: null,
    &quot;logit_bias&quot;: null,
    &quot;logprobs&quot;: null,
    &quot;top_logprobs&quot;: null,
    &quot;max_tokens&quot;: null,
    &quot;n&quot;: 1,
    &quot;presence_penalty&quot;: null,
    &quot;response_format&quot;: null,
    &quot;seed&quot;: null,
    &quot;stop&quot;: null,
    &quot;stream&quot;: false,
    &quot;temperature&quot;: 1,
    &quot;top_p&quot;: 1,
    &quot;tools&quot;: null,
    &quot;tool_choice&quot;: null,
    &quot;user&quot;: null,
    &quot;wasm_tools&quot;: [],
    &quot;mcp_connectors&quot;: [],
    &quot;allow_config_override&quot;: true
  },
  &quot;provider_fallback&quot;: null,
  &quot;memory&quot;: &quot;null&quot;,
  &quot;context&quot;: {
    &quot;default&quot;: null,
    &quot;contexts&quot;: []
  },
  &quot;models&quot;: {
    &quot;include&quot;: [],
    &quot;exclude&quot;: []
  },
  &quot;guardrails&quot;: [],
  &quot;guardrails_fail_on_deny&quot;: false,
  &quot;cache&quot;: {
    &quot;strategy&quot;: &quot;none&quot;,
    &quot;ttl&quot;: 300000,
    &quot;score&quot;: 0.8
  },
  &quot;kind&quot;: &quot;ai-gateway.extensions.cloud-apim.com/Provider&quot;
}
</code></pre>
<pre class="prettyprint"><code class="language-json">{
  &quot;_loc&quot;: {
    &quot;tenant&quot;: &quot;default&quot;,
    &quot;teams&quot;: [
      &quot;default&quot;
    ]
  },
  &quot;id&quot;: &quot;persistent-memory_local&quot;,
  &quot;name&quot;: &quot;Local persistent memory&quot;,
  &quot;description&quot;: &quot;A local persistent memory&quot;,
  &quot;metadata&quot;: {},
  &quot;tags&quot;: [],
  &quot;provider&quot;: &quot;local&quot;,
  &quot;config&quot;: {
    &quot;options&quot;: {
      &quot;session_id&quot;: &quot;${consumer.id || apikey.id || user.email || token.sub || req.ip :: default}&quot;,
      &quot;strategy&quot;: &quot;message_window&quot;,
      &quot;max_messages&quot;: 100
    }
  },
  &quot;kind&quot;: &quot;ai-gateway.extensions.cloud-apim.com/PersistentMemory&quot;
}
</code></pre>
<p>when run with input like:</p>
<pre class="prettyprint"><code class="language-json">{
  &quot;request&quot;: {
    &quot;body_json&quot;: {
      &quot;text&quot;: &quot;hey jarvis, what are the news today ?&quot;
    }
  }
}
</code></pre>
<p>the result is:</p>
<pre class="prettyprint"><code class="language-json">{
  &quot;returned&quot;: {
    &quot;status&quot;: 200,
    &quot;headers&quot;: {
      &quot;Content-Type&quot;: &quot;application/json&quot;
    },
    &quot;body_json&quot;: {
      &quot;text&quot;: &quot;Ah, dear Sir, allow me to present you with a concise overview of the most noteworthy events of the day, as of June 4th, 2025.\n\nOn the international stage, Poland has elected a new president — the conservative Karol Nawrocki — following a tightly contested vote, while in South Korea, opposition leader Lee Jae-myung secured victory in the June 3rd presidential elections.\n\nIn the United States, President Donald Trump is making headlines once again, this time with a series of executive orders, including a controversial revision of diversity and inclusion policies. *The Daily Show* has, of course, offered its trademark satirical take on the developments.\n\nAs for the weather in New York, skies are a brilliant blue, with temperatures ranging from a mild 63°F (17°C) this morning to a predicted high of 82°F (28°C) later today.\n\nOn the financial front, the markets are showing modest gains — the SPDR S&amp;P 500 is slightly up, along with the Dow Jones and the QQQ.\n\nAnd finally, for those with a taste for rock, the band Volbeat is set to release its new album *God of Angels Trust* on June 6th, followed by the eagerly awaited Oasis reunion tour, kicking off on July 4th in Cardiff.\n\nShould you wish to delve deeper into any of these topics, I remain entirely at your disposal, of course.&quot;,
      &quot;audio_base64&quot;: {
        &quot;content_type&quot;: &quot;audio/mpeg&quot;,
        &quot;base64&quot;: &quot;...&quot;
      }
    }
  },
  &quot;error&quot;: null
}
</code></pre>
<p>the memory content is:</p>
<pre class="prettyprint"><code class="language-json">{
  &quot;call_res&quot;: {
    &quot;status&quot;: 200,
    &quot;headers&quot;: {
      &quot;Content-Type&quot;: &quot;application/json&quot;
    },
    &quot;body_json&quot;: {
      &quot;text&quot;: &quot;Ah, dear Sir, allow me to present you with a concise overview of the most noteworthy events of the day, as of June 4th, 2025.\n\nOn the international stage, Poland has elected a new president — the conservative Karol Nawrocki — following a tightly contested vote, while in South Korea, opposition leader Lee Jae-myung secured victory in the June 3rd presidential elections.\n\nIn the United States, President Donald Trump is making headlines once again, this time with a series of executive orders, including a controversial revision of diversity and inclusion policies. *The Daily Show* has, of course, offered its trademark satirical take on the developments.\n\nAs for the weather in New York, skies are a brilliant blue, with temperatures ranging from a mild 63°F (17°C) this morning to a predicted high of 82°F (28°C) later today.\n\nOn the financial front, the markets are showing modest gains — the SPDR S&amp;P 500 is slightly up, along with the Dow Jones and the QQQ.\n\nAnd finally, for those with a taste for rock, the band Volbeat is set to release its new album *God of Angels Trust* on June 6th, followed by the eagerly awaited Oasis reunion tour, kicking off on July 4th in Cardiff.\n\nShould you wish to delve deeper into any of these topics, I remain entirely at your disposal, of course.&quot;,
      &quot;audio_base64&quot;: {
        &quot;content_type&quot;: &quot;audio/mpeg&quot;,
        &quot;base_64&quot;: &quot;...&quot;
      }
    }
  },
  &quot;play&quot;: {
    &quot;stdout&quot;: &quot;&quot;,
    &quot;stderr&quot;: &quot;&quot;,
    &quot;code&quot;: 0
  },
  &quot;jarvis&quot;: &quot;Ah, dear Sir, allow me to present you with a concise overview of the most noteworthy events of the day, as of June 4th, 2025.\n\nOn the international stage, Poland has elected a new president — the conservative Karol Nawrocki — following a tightly contested vote, while in South Korea, opposition leader Lee Jae-myung secured victory in the June 3rd presidential elections.\n\nIn the United States, President Donald Trump is making headlines once again, this time with a series of executive orders, including a controversial revision of diversity and inclusion policies. *The Daily Show* has, of course, offered its trademark satirical take on the developments.\n\nAs for the weather in New York, skies are a brilliant blue, with temperatures ranging from a mild 63°F (17°C) this morning to a predicted high of 82°F (28°C) later today.\n\nOn the financial front, the markets are showing modest gains — the SPDR S&amp;P 500 is slightly up, along with the Dow Jones and the QQQ.\n\nAnd finally, for those with a taste for rock, the band Volbeat is set to release its new album *God of Angels Trust* on June 6th, followed by the eagerly awaited Oasis reunion tour, kicking off on July 4th in Cardiff.\n\nShould you wish to delve deeper into any of these topics, I remain entirely at your disposal, of course.&quot;,
  &quot;agent-1&quot;: &quot;Here are the latest news updates for today, June 4, 2025:\n\n### International News\n- **Poland Elects New President**: Karol Nawrocki, a conservative historian, recently won the Polish presidential election in a narrow victory.\n- **South Korea&#39;s Presidential Election**: The opposition candidate, Lee Jae-myung, secured a decisive win in South Korea&#39;s presidential election on June 3.\n\n### United States News\n- **Political Developments**: President Donald Trump is making headlines with a series of executive orders, including the rollback of government diversity, equity, and inclusion (DEI) and affirmative action rules.\n- **Media and Entertainment**: \&quot;The Daily Show\&quot; continues to cover current events, focusing on President Trump&#39;s recent actions.\n\n### Weather Update for New York, NY\n- **Current Conditions**: Mostly sunny, 63°F (17°C).\n- **Hourly Forecast**:\n  - 12:00 PM: 78°F (26°C)\n  - 1:00 PM: 80°F (26°C)\n  - 2:00 PM: 82°F (28°C)\n\n### Financial Markets\n- **SPDR S&amp;P 500 ETF Trust (SPY)**: Trading at $596.09, up $3.37 (0.57%).\n- **SPDR Dow Jones Industrial Average ETF (DIA)**: Trading at $426.01, up $2.22 (0.52%).\n- **Invesco QQQ Trust Series 1 (QQQ)**: Trading at $527.30, up $4.14 (0.79%).\n\n### Upcoming Events\n- **Volbeat&#39;s Album Release**: Their ninth studio album, \&quot;God of Angels Trust,\&quot; is set to be released on June 6, 2025.\n- **Oasis Reunion Tour**: The band&#39;s reunion tour, \&quot;Oasis Live &#39;25,\&quot; will kick off on July 4 in Cardiff, UK.\n\nFor more details, feel free to ask!&quot;,
  &quot;input_text&quot;: &quot;hey jarvis, what are the news today ?&quot;,
  &quot;audio_base64&quot;: {
    &quot;content_type&quot;: &quot;audio/mpeg&quot;,
    &quot;base_64&quot;: &quot;...&quot;
  },
  &quot;audio_file&quot;: {
    &quot;file_path&quot;: &quot;/var/folders/b4/_vkrx8n14qq2hx2y4hwln09w0000gn/T/llm-ext-fw-6827936985828753129.tmp&quot;
  },
  &quot;input&quot;: {
    &quot;request&quot;: {
      &quot;body_json&quot;: {
        &quot;text&quot;: &quot;hey jarvis, what are the news today ?&quot;
      }
    }
  }
}
</code></pre>
<h2><a href="#next-steps" name="next-steps" class="anchor"><span class="anchor-link"></span></a>Next Steps</h2>
<p>Workflows in Otoroshi open the door to advanced runtime logic inside your API Gateway. You can build integrations, automations, validators, orchestrations, and more — all in pure JSON.</p>
<p>For production-grade scenarios, consider:</p>
<ul>
  <li>Building and testing reusable workflows</li>
  <li>Adding your own functions/operators</li>
  <li>Securing workflows with access rights and guards</li>
</ul>
<p>You can even go as far as using workflows to implement AI agents, task runners, or content pipelines.</p>
<div class="nav-next">
<p><strong>Next:</strong> <a href="../how-to-s/index.html">How to&rsquo;s</a></p>
</div>
</div>
<div class="large-3 show-for-large column" data-sticky-container>
<nav class="sidebar sticky" data-sticky data-anchor="docs" data-sticky-on="large">
<div class="page-nav">
<div class="nav-title">
<h3>On this page</h3>
</div>
<div class="nav-toc">
<ul>
  <li><a href="../topics/workflows.html#otoroshi-workflows" class="header">Otoroshi Workflows</a>
  <ul>
    <li><a href="../topics/workflows.html#key-concepts" class="header">Key Concepts</a></li>
    <li><a href="../topics/workflows.html#basic-example" class="header">Basic Example</a></li>
    <li><a href="../topics/workflows.html#memory" class="header">Memory</a></li>
    <li><a href="../topics/workflows.html#nodes" class="header">Nodes</a></li>
    <li><a href="../topics/workflows.html#functions" class="header">Functions</a></li>
    <li><a href="../topics/workflows.html#operators" class="header">Operators</a></li>
    <li><a href="../topics/workflows.html#plugins" class="header">Plugins</a></li>
    <li><a href="../topics/workflows.html#examples" class="header">Examples</a></li>
    <li><a href="../topics/workflows.html#next-steps" class="header">Next Steps</a></li>
  </ul></li>
</ul>
</div>
</div>
</nav>
</div>
</div>

</section>
</div>

</div>

<footer class="site-footer">

<section class="site-footer-nav">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 medium-4 large-3 text-center column">
<div class="nav-links">
<ul>
<!-- <li><a href="https://www.example.com/products/">Products</a> -->
</ul>
</div>
</div>

</div>
</div>
</div>
</section>

<section class="site-footer-base">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 text-center large-9 column">

<!--
<div class="copyright">
<span class="text">&copy; 2025</span>
<a href="https://www.example.com" class="logo">logo</a>
</div>
-->
</div>

</div>
</div>
</div>
</section>
</footer>

</div>
</div>
</div>
</body>

<script type="text/javascript" src="../lib/foundation/dist/foundation.min.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/magellan.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">jQuery(function(){window.prettyPrint && prettyPrint()});</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/elasticlunr/0.9.5/elasticlunr.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-112498312-1"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'UA-112498312-1');
</script>
</html>




